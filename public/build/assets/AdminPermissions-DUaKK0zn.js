import{a as Q}from"./adminPaginationMixin-DN7Wb3ng.js";import{_ as H,c as p,b as l,a as o,w as n,f as r,r as m,d as C,e as _,F as w,z as b,t as a,g as R,D as j,o as u,y as K}from"./app-CnnV-4Hh.js";const T={mixins:[Q],data(){return{permissions:[],groupedPermissions:{},groups:[],dialog:!1,editingPermission:null,viewMode:"flat",searchQuery:"",selectedGroup:null,newGroup:"",form:{name:"",slug:"",group:"",description:""},rules:{required:t=>!!t||"This field is required"}}},async mounted(){await this.loadGroups(),await this.loadPermissions()},methods:{async loadPermissions(){try{this.loading=!0;const t={};this.searchQuery&&(t.search=this.searchQuery),this.selectedGroup&&(t.group=this.selectedGroup),this.viewMode==="grouped"?t.grouped=!0:(t.page=this.currentPage,t.per_page=this.perPage);const e=await this.$axios.get("/api/v1/permissions",{params:t,headers:this.getAuthHeaders()});this.viewMode==="grouped"?(this.groupedPermissions=e.data,this.permissions=[],Object.values(e.data).forEach(h=>{this.permissions.push(...h)}),this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}):(e.data.data?(this.permissions=e.data.data||[],this.pagination={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total}):(this.permissions=e.data||[],this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}),this.groupedPermissions={},this.permissions.forEach(h=>{this.groupedPermissions[h.group]||(this.groupedPermissions[h.group]=[]),this.groupedPermissions[h.group].push(h)}))}catch(t){this.handleApiError(t,"Failed to load permissions")}finally{this.loading=!1}},async loadGroups(){try{const t=await this.$axios.get("/api/v1/permissions/groups",{headers:this.getAuthHeaders()});t.data&&t.data.length>0?typeof t.data[0]=="string"?this.groups=t.data.map(e=>({name:e,permissions_count:0})):this.groups=t.data:this.groups=[]}catch(t){console.error("Error loading groups:",t),this.groups=[]}},openDialog(t){t?(this.editingPermission=t,this.form={name:t.name,slug:t.slug,group:t.group,description:t.description||""}):(this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""}),this.dialog=!0},closeDialog(){this.dialog=!1,this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""},this.$refs.permissionForm&&this.$refs.permissionForm.resetValidation()},autoGenerateSlugFromName(){!this.form.slug&&this.form.name&&!this.editingPermission&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},addNewGroup(){if(this.newGroup&&!this.groups.find(t=>t.name===this.newGroup||typeof t=="string"&&t===this.newGroup)){const t=this.newGroup.trim();this.groups.push({name:t,permissions_count:0}),this.form.group=t,this.newGroup=""}},async savePermission(){if(!this.$refs.permissionForm){this.showError("Form reference not found");return}if(this.$refs.permissionForm.validate()){!this.form.slug&&this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")),this.saving=!0;try{const t=this.editingPermission?`/api/v1/permissions/${this.editingPermission.id}`:"/api/v1/permissions",e=this.editingPermission?"put":"post",h={name:this.form.name.trim(),slug:this.form.slug?this.form.slug.trim():null,group:this.form.group.trim(),description:this.form.description?this.form.description.trim():null};await this.$axios[e](t,h,{headers:this.getAuthHeaders()}),this.showSuccess(this.editingPermission?"Permission updated successfully":"Permission created successfully"),this.closeDialog(),await this.loadGroups(),await this.loadPermissions()}catch(t){this.handleApiError(t,"Error saving permission")}finally{this.saving=!1}}},async deletePermission(t){if((t.roles_count||0)>0){this.showError("Cannot delete permission that is assigned to roles. Please remove it from all roles first.");return}if(confirm(`Are you sure you want to delete the permission "${t.name}"?`))try{await this.$axios.delete(`/api/v1/permissions/${t.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Permission deleted successfully"),await this.loadPermissions()}catch(e){this.handleApiError(e,"Error deleting permission")}},getGroupColor(t){return{general:"primary",content:"success",users:"info",leads:"warning",careers:"purple",settings:"orange",system:"error"}[t]||"grey"},onPerPageChange(){this.resetPagination(),this.loadPermissions()},onSort(t){this.handleSort(t),this.loadPermissions()},filterByGroup(t){this.selectedGroup===t?this.clearGroupFilter():(this.selectedGroup=t,this.resetPagination(),this.loadPermissions())},clearGroupFilter(){this.selectedGroup=null,this.resetPagination(),this.loadPermissions()}},watch:{viewMode(){this.currentPage=1,this.loadPermissions()}}},O={class:"page-header"},J={class:"d-flex align-center flex-wrap",style:{gap:"8px"}},W={class:"text-caption text-grey"},X={key:0},Y={key:0},Z={class:"text-h6 mb-3"},$={class:"d-flex align-center"},ee={class:"d-flex align-center"},te={class:"d-flex"},se={class:"font-weight-medium"},le={class:"text-caption text-grey"},oe={class:"d-flex align-center"},ie={class:"d-flex align-center"},ne={class:"d-flex align-center"},re={class:"d-flex"},ae={class:"font-weight-medium"},de={class:"text-caption text-grey"},ue={key:0},me={key:2,class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},pe={class:"text-caption text-grey"},ge={key:0},fe={key:0,class:"ml-2"},he={key:1},ce={key:0,class:"d-flex align-center gap-2"};function ve(t,e,h,ye,i,d){const c=m("v-btn"),x=m("v-select"),S=m("v-col"),k=m("v-text-field"),M=m("v-row"),V=m("v-card-text"),G=m("v-card"),y=m("v-icon"),N=m("v-btn-toggle"),v=m("v-chip"),z=m("v-card-title"),g=m("v-skeleton-loader"),F=m("v-table"),U=m("v-pagination"),A=m("v-list-item"),D=m("v-textarea"),E=m("v-form"),B=m("v-spacer"),q=m("v-card-actions"),I=m("v-dialog");return u(),p("div",null,[l("div",O,[e[18]||(e[18]=l("h1",{class:"text-h4 page-title"},"Permission Management",-1)),o(c,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=s=>d.openDialog(null)),class:"add-button"},{default:n(()=>e[17]||(e[17]=[r(" Add New Permission ")])),_:1,__:[17]})]),o(G,{class:"mb-4"},{default:n(()=>[o(V,null,{default:n(()=>[o(M,null,{default:n(()=>[i.viewMode==="flat"?(u(),C(S,{key:0,cols:"12",md:"4"},{default:n(()=>[o(x,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=s=>t.perPage=s),d.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})):_("",!0),o(S,{cols:"12",md:i.viewMode==="flat"?4:6},{default:n(()=>[o(x,{modelValue:i.selectedGroup,"onUpdate:modelValue":[e[2]||(e[2]=s=>i.selectedGroup=s),d.loadPermissions],items:i.groups,"item-title":s=>typeof s=="string"?s:s.name,"item-value":s=>typeof s=="string"?s:s.name,label:"Filter by Group","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","item-title","item-value","onUpdate:modelValue"])]),_:1},8,["md"]),o(S,{cols:"12",md:i.viewMode==="flat"?4:6},{default:n(()=>[o(k,{modelValue:i.searchQuery,"onUpdate:modelValue":[e[3]||(e[3]=s=>i.searchQuery=s),d.loadPermissions],label:"Search permissions","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["md"])]),_:1})]),_:1})]),_:1}),o(G,{class:"mb-4"},{default:n(()=>[o(V,{class:"py-3"},{default:n(()=>[l("div",J,[o(N,{modelValue:i.viewMode,"onUpdate:modelValue":e[4]||(e[4]=s=>i.viewMode=s),mandatory:"",density:"compact",class:"mr-4"},{default:n(()=>[o(c,{value:"flat",size:"small"},{default:n(()=>[o(y,{start:""},{default:n(()=>e[19]||(e[19]=[r("mdi-format-list-bulleted")])),_:1,__:[19]}),e[20]||(e[20]=r(" Flat View "))]),_:1,__:[20]}),o(c,{value:"grouped",size:"small"},{default:n(()=>[o(y,{start:""},{default:n(()=>e[21]||(e[21]=[r("mdi-folder")])),_:1,__:[21]}),e[22]||(e[22]=r(" Grouped View "))]),_:1,__:[22]})]),_:1},8,["modelValue"]),e[24]||(e[24]=l("span",{class:"text-caption text-grey mr-2"},"Filter by Group:",-1)),(u(!0),p(w,null,b(i.groups,s=>(u(),C(v,{key:s.name,color:d.getGroupColor(s.name),size:"small",variant:i.selectedGroup===s.name?"flat":"outlined",class:K([{"font-weight-bold":i.selectedGroup===s.name},"group-filter-chip"]),onClick:P=>d.filterByGroup(s.name),style:{cursor:"pointer"}},{default:n(()=>[r(a(s.name)+" ",1),o(v,{size:"x-small",color:i.selectedGroup===s.name?"white":d.getGroupColor(s.name),variant:"flat",class:"ml-2"},{default:n(()=>[r(a(s.permissions_count||0),1)]),_:2},1032,["color"])]),_:2},1032,["color","variant","class","onClick"]))),128)),i.selectedGroup?(u(),C(v,{key:0,size:"small",color:"grey",variant:"text","prepend-icon":"mdi-close",onClick:d.clearGroupFilter,style:{cursor:"pointer"},class:"ml-2"},{default:n(()=>e[23]||(e[23]=[r(" Clear Filter ")])),_:1,__:[23]},8,["onClick"])):_("",!0)])]),_:1})]),_:1}),o(G,null,{default:n(()=>[o(z,{class:"d-flex justify-space-between align-center"},{default:n(()=>[e[26]||(e[26]=l("span",null,"Permissions",-1)),l("span",W,[e[25]||(e[25]=r(" Total Records: ")),l("strong",null,a(t.pagination.total||0),1),i.permissions.length>0&&i.viewMode==="flat"?(u(),p("span",X," | Showing "+a((t.currentPage-1)*t.perPage+1)+" to "+a(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+a(t.pagination.total),1)):_("",!0)])]),_:1,__:[26]}),o(V,null,{default:n(()=>[i.viewMode==="grouped"?(u(),p("div",Y,[(u(!0),p(w,null,b(i.groupedPermissions,(s,P)=>(u(),p("div",{key:P,class:"mb-6"},[l("h3",Z,[r(a(P.charAt(0).toUpperCase()+P.slice(1))+" ",1),o(v,{size:"small",color:"primary",variant:"text",class:"ml-2"},{default:n(()=>[r(a(s.length)+" permission"+a(s.length!==1?"s":""),1)]),_:2},1024)]),o(F,null,{default:n(()=>[l("thead",null,[l("tr",null,[l("th",{class:"sortable",onClick:e[5]||(e[5]=f=>d.onSort("name"))},[l("div",$,[e[27]||(e[27]=r(" Name ")),o(y,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),l("th",{class:"sortable",onClick:e[6]||(e[6]=f=>d.onSort("slug"))},[l("div",ee,[e[28]||(e[28]=r(" Slug ")),o(y,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[29]||(e[29]=l("th",null,"Description",-1)),e[30]||(e[30]=l("th",null,"Roles",-1)),e[31]||(e[31]=l("th",null,"Actions",-1))])]),l("tbody",null,[t.loading?(u(),p(w,{key:0},b(5,f=>l("tr",{key:`skeleton-grouped-${f}`},[l("td",null,[o(g,{type:"text",width:"150"})]),l("td",null,[o(g,{type:"chip",width:"120",height:"24"})]),l("td",null,[o(g,{type:"text",width:"200"})]),l("td",null,[o(g,{type:"chip",width:"60",height:"24"})]),l("td",null,[l("div",te,[o(g,{type:"button",width:"32",height:"32",class:"mr-1"}),o(g,{type:"button",width:"32",height:"32"})])])])),64)):(u(!0),p(w,{key:1},b(s,f=>(u(),p("tr",{key:f.id},[l("td",null,[l("div",se,a(f.name),1)]),l("td",null,[o(v,{size:"small",variant:"outlined"},{default:n(()=>[r(a(f.slug),1)]),_:2},1024)]),l("td",null,[l("span",le,a(f.description||"No description"),1)]),l("td",null,[o(v,{size:"small",color:"info",variant:"text"},{default:n(()=>[r(a(f.roles_count||0)+" role"+a((f.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),l("td",null,[o(c,{size:"small",icon:"mdi-pencil",onClick:L=>d.openDialog(f),variant:"text"},null,8,["onClick"]),o(c,{size:"small",icon:"mdi-delete",onClick:L=>d.deletePermission(f),variant:"text",color:"error",disabled:(f.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128))])]),_:2},1024)]))),128))])):(u(),C(F,{key:1},{default:n(()=>[l("thead",null,[l("tr",null,[l("th",{class:"sortable",onClick:e[7]||(e[7]=s=>d.onSort("name"))},[l("div",oe,[e[32]||(e[32]=r(" Name ")),o(y,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),l("th",{class:"sortable",onClick:e[8]||(e[8]=s=>d.onSort("slug"))},[l("div",ie,[e[33]||(e[33]=r(" Slug ")),o(y,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),l("th",{class:"sortable",onClick:e[9]||(e[9]=s=>d.onSort("group"))},[l("div",ne,[e[34]||(e[34]=r(" Group ")),o(y,{icon:t.getSortIcon("group"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[35]||(e[35]=l("th",null,"Description",-1)),e[36]||(e[36]=l("th",null,"Roles",-1)),e[37]||(e[37]=l("th",null,"Actions",-1))])]),l("tbody",null,[t.loading?(u(),p(w,{key:0},b(5,s=>l("tr",{key:`skeleton-flat-${s}`},[l("td",null,[o(g,{type:"text",width:"150"})]),l("td",null,[o(g,{type:"chip",width:"120",height:"24"})]),l("td",null,[o(g,{type:"chip",width:"100",height:"24"})]),l("td",null,[o(g,{type:"text",width:"200"})]),l("td",null,[o(g,{type:"chip",width:"60",height:"24"})]),l("td",null,[l("div",re,[o(g,{type:"button",width:"32",height:"32",class:"mr-1"}),o(g,{type:"button",width:"32",height:"32"})])])])),64)):(u(),p(w,{key:1},[(u(!0),p(w,null,b(i.permissions,s=>(u(),p("tr",{key:s.id},[l("td",null,[l("div",ae,a(s.name),1)]),l("td",null,[o(v,{size:"small",variant:"outlined"},{default:n(()=>[r(a(s.slug),1)]),_:2},1024)]),l("td",null,[o(v,{size:"small",color:d.getGroupColor(s.group)},{default:n(()=>[r(a(s.group),1)]),_:2},1032,["color"])]),l("td",null,[l("span",de,a(s.description||"No description"),1)]),l("td",null,[o(v,{size:"small",color:"info",variant:"text"},{default:n(()=>[r(a(s.roles_count||0)+" role"+a((s.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),l("td",null,[o(c,{size:"small",icon:"mdi-pencil",onClick:P=>d.openDialog(s),variant:"text"},null,8,["onClick"]),o(c,{size:"small",icon:"mdi-delete",onClick:P=>d.deletePermission(s),variant:"text",color:"error",disabled:(s.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128)),i.permissions.length===0?(u(),p("tr",ue,e[38]||(e[38]=[l("td",{colspan:"6",class:"text-center py-4"},"No permissions found",-1)]))):_("",!0)],64))])]),_:1})),i.viewMode==="flat"?(u(),p("div",me,[l("div",pe,[i.permissions.length>0&&t.pagination.total>0?(u(),p("span",ge,[e[39]||(e[39]=r(" Showing ")),l("strong",null,a((t.currentPage-1)*t.perPage+1),1),e[40]||(e[40]=r(" to ")),l("strong",null,a(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[41]||(e[41]=r(" of ")),l("strong",null,a(t.pagination.total.toLocaleString()),1),e[42]||(e[42]=r(" records ")),t.pagination.last_page>1?(u(),p("span",fe," (Page "+a(t.currentPage)+" of "+a(t.pagination.last_page)+") ",1)):_("",!0)])):(u(),p("span",he," No records found "))]),t.pagination.last_page>1?(u(),p("div",ce,[o(U,{modelValue:t.currentPage,"onUpdate:modelValue":[e[10]||(e[10]=s=>t.currentPage=s),d.loadPermissions],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):_("",!0)])):_("",!0)]),_:1})]),_:1}),o(I,{modelValue:i.dialog,"onUpdate:modelValue":e[16]||(e[16]=s=>i.dialog=s),"max-width":"600",persistent:""},{default:n(()=>[o(G,null,{default:n(()=>[o(z,null,{default:n(()=>[r(a(i.editingPermission?"Edit Permission":"Add New Permission"),1)]),_:1}),o(V,null,{default:n(()=>[o(E,{ref:"permissionForm",onSubmit:R(d.savePermission,["prevent"])},{default:n(()=>[o(k,{modelValue:i.form.name,"onUpdate:modelValue":e[11]||(e[11]=s=>i.form.name=s),label:"Permission Name",rules:[i.rules.required],required:"",hint:"Display name for the permission (e.g., 'Manage Pages')","persistent-hint":"",class:"mb-4",onBlur:d.autoGenerateSlugFromName},null,8,["modelValue","rules","onBlur"]),o(k,{modelValue:i.form.slug,"onUpdate:modelValue":e[12]||(e[12]=s=>i.form.slug=s),label:"Slug",hint:"URL-friendly identifier (auto-generated if empty)","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),o(x,{modelValue:i.form.group,"onUpdate:modelValue":e[14]||(e[14]=s=>i.form.group=s),items:i.groups,"item-title":s=>typeof s=="string"?s:s.name,"item-value":s=>typeof s=="string"?s:s.name,label:"Group",rules:[i.rules.required],required:"",hint:"Category/group for organizing permissions","persistent-hint":"",class:"mb-4"},{"append-item":n(()=>[o(A,null,{default:n(()=>[o(k,{modelValue:i.newGroup,"onUpdate:modelValue":e[13]||(e[13]=s=>i.newGroup=s),label:"Add New Group","prepend-inner-icon":"mdi-plus",variant:"outlined",density:"compact",onKeyup:j(d.addNewGroup,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["modelValue","items","item-title","item-value","rules"]),o(D,{modelValue:i.form.description,"onUpdate:modelValue":e[15]||(e[15]=s=>i.form.description=s),label:"Description",hint:"Brief description of what this permission allows","persistent-hint":"",rows:"2",class:"mb-4"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),o(q,null,{default:n(()=>[o(B),o(c,{onClick:d.closeDialog,variant:"text"},{default:n(()=>e[43]||(e[43]=[r("Cancel")])),_:1,__:[43]},8,["onClick"]),o(c,{onClick:d.savePermission,color:"primary",loading:t.saving},{default:n(()=>[r(a(i.editingPermission?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Pe=H(T,[["render",ve]]);export{Pe as default};
