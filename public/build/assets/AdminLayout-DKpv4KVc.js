import{h as E}from"./moment-C5S46NFB.js";import{_ as M,c as w,a as t,w as o,b as n,d as c,e as g,r,f as m,t as h,m as S,g as F,u as A,o as l}from"./app-CnnV-4Hh.js";import{r as j}from"./uploads-CnEkgyD_.js";import{U as q}from"./UserProfileDialog-BCG5KECv.js";const G={components:{UserProfileDialog:q},data(){return{drawer:!0,authStore:null,currentUser:null,userRoles:[],userPermissions:[],currentDate:E().format("Do MMMM YYYY"),currentYear:new Date().getFullYear(),brandingLogo:null,siteName:null,profileDialogVisible:!1,footerPoweredByText:null,footerVersion:null,footerCopyrightText:null}},computed:{resolvedBrandingLogo(){return this.brandingLogo?this.resolveImageUrl(this.brandingLogo):null},resolvedUserAvatar(){return!this.currentUser||!this.currentUser.avatar?null:this.resolveImageUrl(this.currentUser.avatar)}},methods:{async loadUser(){var i;try{const e=localStorage.getItem("admin_token");if(!e){this.$router.push("/admin/login");return}const _=await this.$axios.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${e}`}});this.currentUser=_.data,this.userRoles=_.data.roles||[],this.authStore&&(this.authStore.user=_.data,this.authStore.token=e,this.authStore.isAuthenticated=!0,this.authStore.extractRolesAndPermissions(_.data)),this.userPermissions=[],this.userRoles&&this.userRoles.length>0&&this.userRoles.forEach(p=>{p.permissions&&p.permissions.length>0&&p.permissions.forEach(s=>{this.userPermissions.includes(s.slug)||this.userPermissions.push(s.slug)})})}catch(e){console.error("Error loading user:",e),((i=e.response)==null?void 0:i.status)===401&&(localStorage.removeItem("admin_token"),this.$router.push("/admin/login"))}},async loadSettings(){try{const i=localStorage.getItem("admin_token");if(!i)return;const e=await this.$axios.get("/api/v1/settings",{headers:{Authorization:`Bearer ${i}`}});e.data.general&&e.data.general.site_name&&e.data.general.site_name.value?this.siteName=e.data.general.site_name.value:this.siteName=null,e.data.branding&&e.data.branding.logo&&e.data.branding.logo.value?this.brandingLogo=e.data.branding.logo.value:this.brandingLogo=null,e.data.footer?(e.data.footer.powered_by_text&&e.data.footer.powered_by_text.value?this.footerPoweredByText=e.data.footer.powered_by_text.value:this.footerPoweredByText=null,e.data.footer.version&&e.data.footer.version.value?this.footerVersion=e.data.footer.version.value:this.footerVersion=null,e.data.footer.copyright_text&&e.data.footer.copyright_text.value?this.footerCopyrightText=e.data.footer.copyright_text.value:this.footerCopyrightText=null):(this.footerPoweredByText=null,this.footerVersion=null,this.footerCopyrightText=null)}catch(i){console.error("Error loading settings:",i)}},async logout(){await A().logout(),this.currentUser=null,this.userRoles=[],this.userPermissions=[],this.$router.push("/admin/login")},hasPermission(i){return this.authStore&&(this.authStore.hasRole&&this.authStore.hasRole(["administrator"])||this.authStore.hasPermission&&this.authStore.hasPermission(i))?!0:!this.currentUser||!this.userPermissions||this.userPermissions.length===0?!1:this.userRoles&&this.userRoles.length>0&&this.userRoles.some(e=>e.slug==="administrator")?!0:this.userPermissions.includes(i)},resolveImageUrl(i){return j(i)},showProfileDialog(){this.profileDialogVisible=!0}},mounted(){this.authStore=A(),localStorage.getItem("admin_token")?(this.loadUser(),this.loadSettings()):this.$router.push("/admin/login")},watch:{$route(i,e){(i.name==="AdminSettings"||e&&e.name==="AdminSettings")&&this.loadSettings()}}},H={class:"pa-2"},J={key:1,class:"d-flex align-center mr-4"},K={class:"footer-content"},O={class:"footer-brand"},Q={class:"logo-wrapper"},W=["src"],X={class:"brand-text"},Z={class:"brand-name"},$={class:"footer-info"},ee={class:"version-badge"},te={class:"copyright-text"};function oe(i,e,_,p,s,u){const f=r("v-img"),b=r("v-avatar"),y=r("v-list-item-title"),d=r("v-list-item"),k=r("v-divider"),R=r("v-list-group"),P=r("v-list"),v=r("v-icon"),V=r("v-btn"),L=r("v-navigation-drawer"),D=r("v-app-bar-nav-icon"),x=r("v-chip"),U=r("v-spacer"),B=r("v-menu"),C=r("v-app-bar"),T=r("router-view"),I=r("v-container"),N=r("v-main"),Y=r("v-footer"),z=r("UserProfileDialog");return l(),w("div",null,[t(L,{modelValue:s.drawer,"onUpdate:modelValue":e[1]||(e[1]=a=>s.drawer=a),class:"gradient_color",location:"left",permanent:"","hide-overlay":"",app:"",dark:""},{append:o(()=>[n("div",H,[t(V,{link:"",router:"",onClick:e[0]||(e[0]=a=>u.logout()),class:"logout-btn text-black",size:"small",block:""},{default:o(()=>[t(v,{left:""},{default:o(()=>e[5]||(e[5]=[m("mdi-logout")])),_:1,__:[5]}),e[6]||(e[6]=m("Logout "))]),_:1,__:[6]})])]),default:o(()=>[e[7]||(e[7]=n("div",{class:"sidebar-shapes"},[n("div",{class:"shape shape-1"}),n("div",{class:"shape shape-2"}),n("div",{class:"shape shape-3"})],-1)),s.currentUser?(l(),c(d,{key:0,class:"user-profile-header"},{prepend:o(()=>[t(b,{size:"48",class:"mr-3"},{default:o(()=>[t(f,{src:u.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"Logo",cover:""},null,8,["src"])]),_:1})]),default:o(()=>[t(y,{class:"text-h6 font-weight-bold"},{default:o(()=>[m(h(s.siteName||"Admin Panel"),1)]),_:1})]),_:1})):g("",!0),t(k,{class:"my-0 divider-glow"}),s.currentUser&&s.userPermissions.length>0?(l(),c(P,{key:1,density:"compact",nav:""},{default:o(()=>[u.hasPermission("access-dashboard")?(l(),c(d,{key:0,link:"",router:"","prepend-icon":"mdi-view-dashboard",title:"Dashboard",to:{name:"AdminDashboard"},value:"Dashboard",exact:""})):g("",!0),u.hasPermission("manage-users")?(l(),c(d,{key:1,link:"",router:"","prepend-icon":"mdi-account-group",title:"Users",to:{name:"AdminUsers"},value:"Users",exact:""})):g("",!0),u.hasPermission("manage-roles")?(l(),c(R,{key:2,value:"roles","prepend-icon":"mdi-shield-account","no-action":""},{activator:o(({props:a})=>[t(d,S(a,{title:"Roles & Permissions"}),null,16)]),default:o(()=>[t(d,{"prepend-icon":"mdi-shield-account",title:"Roles",to:{name:"AdminRoles"}}),t(d,{"prepend-icon":"mdi-key",title:"Permissions",to:{name:"AdminPermissions"}})]),_:1})):g("",!0),u.hasPermission("manage-settings")?(l(),c(d,{key:3,link:"",router:"","prepend-icon":"mdi-cog",title:"Settings",to:{name:"AdminSettings"},value:"Settings",exact:""})):g("",!0),u.hasPermission("view-login-logs")?(l(),c(d,{key:4,link:"",router:"","prepend-icon":"mdi-login",title:"Login Logs",to:{name:"AdminLoginLogs"},value:"Login Logs",exact:""})):g("",!0)]),_:1})):g("",!0)]),_:1,__:[7]},8,["modelValue"]),t(C,{app:"",flat:"",density:"compact",class:"gradient_color app-bar-modern"},{default:o(()=>[t(D,{onClick:e[2]||(e[2]=F(a=>s.drawer=!s.drawer,["stop"]))}),t(x,{class:"mx-2 date-chip"},{default:o(()=>[m(h(s.currentDate),1)]),_:1}),t(U),s.currentUser&&s.userRoles&&s.userRoles.some(a=>a.slug==="administrator")?(l(),c(x,{key:0,"prepend-icon":"mdi-shield-account"},{default:o(()=>e[8]||(e[8]=[m("Administrator")])),_:1,__:[8]})):g("",!0),t(U),s.currentUser?(l(),w("div",J,[t(B,{"open-on-hover":""},{activator:o(({props:a})=>[t(b,S(a,{size:"42",class:"fill-image mr-2",title:s.currentUser.name}),{default:o(()=>[s.currentUser.avatar?(l(),c(f,{key:0,cover:"",src:u.resolvedUserAvatar,alt:s.currentUser.name},null,8,["src","alt"])):(l(),c(f,{key:1,cover:"",src:"/assets/logo/logo.png",alt:"image"}))]),_:2},1040,["title"])]),default:o(()=>[t(P,null,{default:o(()=>[t(d,{onClick:u.showProfileDialog,style:{cursor:"pointer"}},{prepend:o(()=>[t(v,null,{default:o(()=>e[9]||(e[9]=[m("mdi-account")])),_:1,__:[9]})]),append:o(()=>[t(v,{size:"small"},{default:o(()=>e[10]||(e[10]=[m("mdi-chevron-right")])),_:1,__:[10]})]),default:o(()=>[t(y,null,{default:o(()=>[m(h(s.currentUser.name),1)]),_:1})]),_:1},8,["onClick"]),t(k,{class:"my-2"}),t(d,{link:"",router:"",onClick:e[3]||(e[3]=a=>u.logout())},{prepend:o(()=>[t(v,null,{default:o(()=>e[11]||(e[11]=[m("mdi-logout")])),_:1,__:[11]})]),default:o(()=>[t(y,null,{default:o(()=>e[12]||(e[12]=[m("Logout")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1})])):g("",!0)]),_:1}),t(N,null,{default:o(()=>[t(I,{fluid:""},{default:o(()=>[t(T)]),_:1})]),_:1}),t(Y,{class:"footer-modern gradient_color rtl-footer",app:""},{default:o(()=>[n("div",K,[n("div",O,[n("div",Q,[n("img",{src:u.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"cpb-it",height:"24",class:"footer-logo"},null,8,W)]),n("div",X,[n("span",Z,h(s.footerPoweredByText||"Powered By CPB-IT"),1)])]),e[13]||(e[13]=n("div",{class:"footer-divider"},null,-1)),n("div",$,[n("span",ee,h(s.footerVersion||"v1.0"),1),n("span",te,"Â© "+h(s.currentYear)+" "+h(s.footerCopyrightText||"All Rights Reserved"),1)])])]),_:1}),t(z,{modelValue:s.profileDialogVisible,"onUpdate:modelValue":e[4]||(e[4]=a=>s.profileDialogVisible=a),user:s.currentUser},null,8,["modelValue","user"])])}const ae=M(G,[["render",oe],["__scopeId","data-v-6310db50"]]);export{ae as default};
